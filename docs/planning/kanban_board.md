v250813b
# PyV-NPU Simulator 개선 과제 칸반보드(chatgpt)

## 다음 작업 우선순위 (Top 5 Next Tasks)

1.  **(Backlog / P0)** **REF-03 | Opcode 상수화**: 코드 안정성 확보를 위해 하드코딩된 Opcode 문자열을 Enum으로 변경합니다. (Effort: Small)
2.  **(Backlog / P0)** **REF-02 | 스케줄러 가독성 개선**: `calculate_op_timing` 함수를 리팩토링하여 복잡도를 낮추고 유지보수성을 확보합니다. (Effort: Medium)
3.  **(Backlog / P1)** **TST-01 | 테스트 커버리지 확대**: `mapper.py`와 다양한 `SimConfig` 조합에 대한 테스트를 추가하여 신뢰도를 높입니다. (Effort: Medium)
4.  **(Backlog / P1)** **M-01 | 메모리/버스 모델 고도화 v1**: `IOBufferTracker`의 FIFO 동작을 개선하고, 시스템 버스 모델을 추가하여 시뮬레이션 정확도를 높입니다. (Effort: Large)
5.  **(Backlog / P1)** **ARC-02 | Py-V L1 캐시 구현**: `Py-V` RISC-V 코어에 L1 캐시를 추가하여 CPU 모델의 현실성을 높입니다. (Effort: Medium)

---

## 컬럼: Backlog → Ready → In-Progress → Review → Done

---

## Backlog

### REF-03 | Opcode 상수화
- **요약**: 코드 전반에 하드코딩된 Opcode 문자열을 `Enum` 클래스로 정의하여 오타 방지 및 일관성 확보.
- **수용기준**: `mapper.py`, `scheduler.py` 등에서 `Enum` 타입으로 Opcode를 비교하도록 수정.
- **우선순위**: P0 / **사이즈**: S / **의존성**: — / **태그**: 리팩토링

### REF-02 | 스케줄러 가독성 개선
- **요약**: `scheduler.py`의 복잡한 함수(`run_scheduler_pass`, `calculate_op_timing`) 내부 로직을 Opcode별 헬퍼 함수 등으로 분리하여 가독성 및 유지보수성 향상.
- **수용기준**: 함수 라인 수 감소 및 복잡도 지표 개선. 기존 스케줄러 테스트 통과.
- **우선순위**: P0 / **사이즈**: M / **의존성**: — / **태그**: 리팩토링, 스케줄러

### TST-01 | 테스트 커버리지 확대
- **요약**: `mapper.py`의 모드별 변환 로직, `reporting.py`의 통계 계산, 다양한 `SimConfig` 옵션 조합에 대한 단위/통합 테스트 추가.
- **수용기준**: 프로젝트 전체 테스트 커버리지 10% 이상 향상.
- **우선순위**: P1 / **사이즈**: M / **의존성**: CI-01 / **태그**: 테스트

### M-01 | 메모리/버스 모델 고도화 v1
- **요약**: SPM bank 포트 수, DMA burst, DRAM 채널/페이지 정책(오픈/클로즈드) 파라미터화. `IOBufferTracker`의 FIFO 동작 개선 및 시스템 버스 모델 추가.
- **수용기준**: bank 충돌 케이스 재현 테스트 3종, burst size 변화에 따른 P95 변동 리포트, FIFO 모델 검증 테스트 추가.
- **우선순위**: P1 / **사이즈**: L / **의존성**: — / **태그**: 메모리, DMA, 버스

### ARC-02 | Py-V L1 캐시 구현
- **요약**: `Py-V` RISC-V 코어에 L1 명령어/데이터 캐시를 추가하여 CPU 모델의 현실성을 높이고, `tight-coupled` 모드의 제어 오버헤드를 정확하게 측정합니다.
- **수용기준**: Py-V CPU 모델에 L1 캐시 모듈 추가 및 연결. 캐시 히트/미스를 반영한 사이클 수 변동을 검증하는 테스트 추가.
- **우선순위**: P1 / **사이즈**: M / **의존성**: — / **태그**: 캐시, Py-V, CPU, 아키텍처

### ARC-01 | L2 캐시 모델 구현
- **요약**: NPU 클러스터에 하드웨어 관리형 L2 캐시 모델을 구현합니다. 캐시 일관성(Coherence)의 기본 모델을 포함하여 SPM과의 성능 비교 분석 기반을 마련합니다.
- **수용기준**: L2 캐시 모듈 구현 및 시스템 통합. 캐시 유무에 따른 벤치마크 성능 비교 리포트 생성.
- **우선순위**: P1 / **사이즈**: L / **의존성**: M-01 / **태그**: 캐시, 메모리, 아키텍처

### C-02 | VC 코스트 모델 v1
- **요약**: RVV 유사 제약(벡터 길이/issue rate) 반영한 element-wise/Reduce 코스트 모델
- **수용기준**: op별 사이클 추정 ≥ 단위테스트 5개, issue rate/메모리 대역폭 바인딩 케이스 재현
- **우선순위**: P1 / **사이즈**: M / **의존성**: — / **태그**: VC, 성능모델

### S-01 | 스케줄러 L2 이벤트 모델 확장
- **요약**: 현재 L2에 NoC 홉 지연, 큐 대기 지연, backpressure 이벤트 추가
- **수용기준**: 이벤트 로그에 홉/큐 지연 개별 카운터 제공, Gantt에 레이어 표시
- **우선순위**: P1 / **사이즈**: L / **의존성**: M-01 / **태그**: 스케줄러, NoC

### P-02 | 연산 Fusion 패스 (elementwise chain)
- **요약**: MatMul → BiasAdd → GELU 등 연속 elementwise 체인을 VC 패킷으로 병합
- **수용기준**: fusion 전/후 NPUOp 수 감소, 사이클/메모리 트래픽 절감 리포트
- **우선순위**: P1 / **사이즈**: M / **의존성**: P-01 / **태그**: 컴파일러, 최적화

### DOC-01 | 개발자 가이드 v1
- **요약**: “ONNX→IR→Program→Schedule→Report” 풀 파이프라인 가이드 & 확장 포인트
- **수용기준**: docs/에 튜토리얼 1편 + 아키텍처 다이어그램 1개(SVG)
- **우선순위**: P1 / **사이즈**: S / **의존성**: R-01 / **태그**: 문서

### EX-01 | 벤치 스크립트
- **요약**: TinyLLaMA, MLP, ConvNet 3세트 자동 실행/리포트 수집 스크립트
- **수용기준**: 결과 디렉토리에 리포트 HTML/JSON, 비교 표 자동 생성
- **우선순위**: P1 / **사이즈**: S / **의존성**: R-01, CFG-01 / **태그**: 예제, 자동화

### P-01 | 컴파일러 타일링 패스 (auto-tile)
- **요약**: shape/메모리 제약 기반 자동 타일 크기 산출 + mapper에 주입
- **수용기준**: 3개 벤치(TinyLLaMA matmul/Conv/GELU)에서 타일링 적용 후 실행 성공 및 총 사이클 감소
- **우선순위**: P2 / **사이즈**: L / **의존성**: C-01, M-01 / **태그**: 컴파일러, 타일링

### CHR-01 | 예외 처리 및 로깅 개선
- **요약**: `onnx_importer.py`에 `FileNotFoundError` 등 구체적인 예외 처리를 추가하고, `print`로 남긴 로그들을 `logging` 모듈을 사용하도록 통일.
- **수용기준**: 존재하지 않는 모델 파일 로드 시 명확한 에러 메시지 출력. `logging` 포맷 통일.
- **우선순위**: P2 / **사이즈**: S / **의존성**: — / **태그**: 안정성, 로깅

### ARC-04 | 공유 L3 캐시 모델 구현
- **요약**: CPU와 NPU 클러스터가 공유하는 L3 캐시를 구현하여 시스템 레벨의 데이터 공유 및 메모리 병목 현상을 분석합니다.
- **수용기준**: L3 캐시 모듈 구현 및 시스템 버스에 연결. L3 캐시 유무에 따른 CPU-NPU 연동 워크로드의 성능 변화 리포트.
- **우선순위**: P2 / **사이즈**: L / **의존성**: ARC-01, ARC-02 / **태그**: 캐시, 메모리, 아키텍처, SoC

### ARC-03 | 비동기 클럭 도메인 구현
- **요약**: 시뮬레이터에 비동기 클럭 도메인 지원을 추가하여 CPU, TC, VC가 각기 다른 클럭 속도를 갖도록 설정하는 기능을 구현합니다.
- **수용기준**: 각 도메인(CPU, NPU)에 별도 클럭 파라미터 설정 기능 추가. 클럭 차이에 따른 이벤트 시간 계산 정확성 검증.
- **우선순위**: P2 / **사이즈**: M / **의존성**: — / **태그**: 클럭, 아키텍처, 성능모델

### REF-01 | 리포팅/시각화 로직 리팩토링
- **요약**: `reporting.py`와 `viz.py`에 중복 구현된 간트 차트 생성 로직을 `viz.py`의 함수로 통합하여 중복 제거.
- **수용기준**: `reporting.py`가 `viz.py`의 함수를 호출하여 모든 리포트(HTML, ASCII)가 정상적으로 생성됨.
- **우선순위**: P2 / **사이즈**: S / **의존성**: — / **태그**: 리팩토링, 리포트

### Q-01 | INT8/QAT 파이프라인 도입 (스텁)
- **요약**: 정수 스케일·제로포인트 메타를 IR에 부착하고 런타임 코스트 보정 훅 추가
- **수용기준**: INT8 경로에서 기능 테스트 통과, 보고서에 정밀도/성능 모드 플래그 표기
- **우선순위**: P2 / **사이즈**: M / **의존성**: P-01 / **태그**: 양자화

### PPA-01 | 에너지 훅 v0
- **요약**: op별 nJ/op 추정 테이블 주입 포인트와 합산 로직
- **수용기준**: 리포트에 총 에너지/ops 별 기여도 표시(근사치)
- **우선순위**: P2 / **사이즈**: M / **의존성**: C-01, M-01 / **태그**: PPA

---

## Ready

## In-Progress

### CI-01 | 테스트 스위트 확장
- **진행**: `config`, `reporting` 모듈에 대한 단위 테스트 추가 완료. 스케줄러의 stall 계산 로직이 안정화되었습니다.
- **차주 목표**: 커버리지 70% 달성, 스케줄러 테스트 케이스 보강.

---

## Review

(None)

---

## Done

### MEM-02 | Input/Output 버퍼 모델 구현
- **요약**: SPM과 별개로 DMA와 연산 유닛 간 데이터 흐름을 제어하는 Input/Output 버퍼(FIFO)를 구현합니다.
- **수용기준**: 버퍼 크기 초과 시 Backpressure 이벤트 발생. DMA와 연산이 버퍼를 통해 데이터를 주고받도록 수정.
- **우선순위**: P0 / **사이즈**: M / **의존성**: MEM-01 / **태그**: 메모리, DMA, Phase1

### MEM-01 | L0 SPM 모델 구현
- **요약**: 연산 유닛(TC)에 가장 가까운 타일 레벨 L0 SPM을 `resources.py`에 추가합니다.
- **수용기준**: L0 SPM 히트 시 1 사이클 미만의 latency 적용. L0-L1 간 데이터 이동 모델링.
- **우선순위**: P0 / **사이즈**: M / **의존성**: — / **태그**: 메모리, SPM, Phase1

### INT-01 | Py-V MMIO 연동 훅 구현
- **요약**: Py-V가 특정 주소에 값을 쓸 때 NPU 작업이 큐에 추가되도록 MMIO 연동 훅을 구현합니다.
- **수용기준**: Py-V에서 MMIO write 실행 시, NPU 시뮬레이터의 스케줄러 로그에 작업이 접수되었음이 기록됨.
- **우선순위**: P0 / **사이즈**: S / **의존성**: — / **태그**: 연동, Py-V, Phase1

### SCH-02 | Double Buffering 기능 구현
- **요약**: 연산(Compute)과 데이터 전송(DMA)을 중첩시켜 연산 유닛의 유휴 시간을 최소화하는 Double Buffering을 구현합니다.
- **수용기준**: MatMul 연산에서 Compute와 Load/Store가 Gantt 차트에서 겹쳐서 표시됨. 순차 실행 대비 총 사이클 수 감소 확인.
- **우선순위**: P0 / **사이즈**: M / **의존성**: — / **태그**: 스케줄러, 성능최적화, Phase1

### T-01 | Tight 모드 제어 경로 구체화
- **요약**: doorbell/CSR/큐 지연, 마이크로코드 발사율 모델
- **수용기준**: tight vs loose 동일 프로그램에서 제어 오버헤드 차이 리포트(P50/P95)
- **우선순위**: P0 / **사이즈**: M / **의존성**: — / **태그**: tight, 제어경로

### C-03 | TC 코스트 모델 단위테스트
- **내용**: C-01을 위한 파라미터 스윕용 테스터(타일/어레이/주기)를 구현하고, 20개 이상의 자동 검증 케이스(경계값 포함)를 추가함. 이 과정에서 발견된 계산 모델의 버그를 수정하여 안정성을 확보함.
- **출력물**: `pyv_npu/runtime/te.py`, `tests/runtime/test_te.py`

### M-02 | DRAM 채널/뱅크 매핑 정책
- **내용**: DRAM 주소를 (채널, 뱅크)로 변환하는 `DramAddressMapper`와, 이를 사용하여 뱅크 경합을 모델링하는 `DramBankTracker`를 구현함. 이를 위해 컴파일러에 메모리 할당 단계를 추가하고, 스케줄러 및 리포팅 파이프라인을 리팩토링함.
- **출력물**: `pyv_npu/compiler/allocator.py`, `pyv_npu/runtime/memory.py`, `pyv_npu/runtime/resources.py`, `pyv_npu/runtime/scheduler.py`, `pyv_npu/cli/main.py`, `pyv_npu/config.py`, `pyv_npu/isa/npu_ir.py`, `tests/**`

### C-01 | TC 코스트 모델 v1
- **내용**: 시스톨릭 어레이의 fill/drain 오버헤드를 반영한 TC 성능 모델 v1을 구현하고, 관련 단위 테스트 및 리포팅 연동을 완료함.
- **출력물**: `pyv_npu/config.py`, `pyv_npu/runtime/te.py`, `pyv_npu/runtime/scheduler.py`, `tests/runtime/test_te.py`, `pyv_npu/utils/reporting.py`

### S-02 | 스케줄러 Stall 계산 로직 수정
- **내용**: 자원 경합 시 Stall 계산이 부정확하던 버그를 수정하고, 다중 bank 동시 접근 테스트 케이스를 추가하여 안정성을 확보함. **추가로, 스케줄러의 리소스 탐색(probe)과 확정(commit) 로직을 분리하여, 탐색 시 부작용이 발생하던 근본적인 결함을 해결함.**
- **출력물**: `pyv_npu/runtime/scheduler.py`, `pyv_npu/runtime/resources.py`, `tests/test_scheduler.py`

### CFG-01 | YAML 하드웨어 설정 외부화
- **내용**: `--config` 인자로 YAML 설정 파일을 로드하고, CLI 인자로 덮어쓰는 기능 구현. 관련 단위 테스트 통과.
- **출력물**: `pyv_npu/config.py`, `tests/test_config.py`

### R-01 | 리포트 확장 (자원 바인딩 브레이크다운)
- **내용**: 스케줄러에 stall 원인(DEP, RESOURCE_*) 추적 기능 추가. 리포트(JSON, HTML)에 stall 정보를 포함하고 간트차트에 시각화. 관련 단위 테스트 통과.
- **출력물**: `pyv_npu/runtime/scheduler.py`, `pyv_npu/utils/reporting.py`, `tests/test_reporting.py`

### BAS-01 | 프로젝트 구조 인덱싱 & 코드 맵
- **내용**: 서브패키지/콜체인 문서화 및 핵심 모듈 해설
- **출력물**: docs/architecture_overview.md, 분석 스니펫

---

## Epics

- **EPIC-COST**: TC/VC/메모리/버스 코스트 모델 고도화（C-01, C-02, M-01, M-02, C-03, S-01）
- **EPIC-COMP**: 컴파일러 최적화 패스（P-01, P-02, P-03, Q-01）
- **EPIC-CTRL**: Tight 모드 제어 경로 및 마이크로코드（T-01）
- **EPIC-REP**: 리포트/시각화/벤치 자동화（R-02, EX-01, DOC-01）
- **EPIC-OPS**: 설정 외부화/테스트/CI（CI-01, S-02）
- **EPIC-TINYGRAD**: `tinygrad` 프론트엔드 지원 (P-03)