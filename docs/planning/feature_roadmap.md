# NPU Simulator Feature Roadmap (PRD v2.4 기반)

본 문서는 `PRD: NPU 시뮬레이터의 메모리 계층 구조 설계 (v2.4)`를 기반으로, Double Buffering 이후 구현할 주요 기능의 로드맵을 정의합니다.

---

## Phase 1: `sim_1` 완성 및 기본 연동 구현

1.  **세분화된 SPM 모델링:**
    - **L0 SPM:** 연산 유닛(TE) 바로 옆에 붙는 초고속 타일 레벨 버퍼를 모델링합니다. 현재의 `BankTracker`를 L1 SPM 용으로 간주하고, L0 개념을 새로 추가해야 합니다.
        - **우선순위**: P0, **난이도**: M
    - **전용 버퍼(Input/Output):** SPM과 별개로, DMA와 연산 유닛 사이의 데이터 흐름을 제어하는 Input/Output 버퍼(FIFO 구조)를 구현합니다.
        - **우선순위**: P0, **난이도**: M

2.  **Py-V 연동 훅(Hook) 구현:**
    - **MMIO 연동 (Loose-Coupled):** Py-V 코어가 특정 주소(e.g., `0x40000020`)에 값을 쓸 때, NPU 스케줄러가 작업을 큐에 넣도록 하는 MMIO 훅을 실제로 연결하고 테스트합니다.
        - **우선순위**: P0, **난이도**: S
    - **기본 Prefetch 모델:** 스케줄러가 DMA에 미리 데이터를 가져오도록 `prefetch_dist`와 같은 힌트를 주는 기능을 추가합니다.
        - **우선순위**: P1, **난이도**: M

---

## Phase 2: `sim_2` 구현 및 스케줄러/NoC 고도화

1.  **NoC(Network-on-Chip) 모델링:**
    - 현재는 단순 대역폭 값만 사용하지만, PRD 요구사항에 따라 NoC를 통과할 때의 **홉(Hop)당 지연 시간**과 **큐(Queue) 대기 시간**을 모델링하여 통신 병목을 더 정확하게 시뮬레이션합니다.
        - **우선순위**: P1, **난이도**: M

2.  **고급 스케줄링 정책:**
    - **CP-prio (Critical-Path Priority):** 전체 작업의 최종 완료 시간을 단축시키기 위해, 가장 급한 연산(Critical Path)을 먼저 스케줄링하는 알고리즘을 추가합니다.
        - **우선순위**: P1, **난이도**: L
    - **Bank-aware Scheduling:** SPM의 뱅크 충돌을 최소화하도록 데이터의 위치를 고려하여 스케줄링하는 기능을 구현합니다.
        - **우선순위**: P1, **난이도**: M

3.  **Py-V 연동 고도화 (Tight-Coupled):**
    - **Custom ISA 디코더:** Py-V 시뮬레이터가 `ENQCMD_T`, `TWAIT` 같은 NPU 전용 명령어를 해석하고, NPU 스케줄러와 상호작용하도록 디코더 훅을 구현합니다.
        - **우선순위**: P1, **난이도**: M

4.  **리포트 및 시각화 강화:**
    - **큐 깊이 시계열 그래프:** NoC나 버퍼의 큐 깊이가 시간에 따라 어떻게 변하는지 시각화하여 병목 지점을 쉽게 찾도록 합니다.
        - **우선순위**: P1, **난이도**: S
    - **뱅크 충돌(%) 통계:** 전체 메모리 접근 중 뱅크 충돌이 얼마나 발생했는지 비율을 리포트에 추가합니다.
        - **우선순위**: P1, **난이도**: S

---

## Phase 3: `sim_3` 및 전체 시스템 통합

1.  **L2 공유 SPM 모델:**
    - 여러 NPU 클러스터가 공유하는 L2 SPM을 구현합니다. 데이터 일관성을 유지하기 위한 **캐시 일관성(CCx) 프로토콜**의 기본 모델을 선택적으로 적용할 수 있도록 합니다.
        - **우선순위**: P2, **난이도**: L

2.  **Full CA(Cycle-Accurate) 모델링:**
    - **파이프라인 스톨:** TE/VE 내부의 파이프라인 레벨에서 발생하는 스톨까지 정밀하게 모델링합니다.
        - **우선순위**: P2, **난이도**: L
    - **Verilator Co-simulation:** 필요시 Verilator로 생성된 RTL과 연동하여 실리콘 수준의 정확도를 갖도록 합니다.
        - **우선순위**: P2, **난이도**: L

3.  **고급 분석 리포트:**
    - **Roofline Plot:** 시뮬레이터의 연산 성능과 메모리 대역폭의 관계를 분석하는 Roofline 그래프를 생성합니다.
        - **우선순위**: P2, **난이도**: M